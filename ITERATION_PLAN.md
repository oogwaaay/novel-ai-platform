# 迭代计划与竞品差距分析

## 一、当前已实现功能 ✅

### 核心功能
- ✅ **小说生成**：基于 idea + genre + length 生成完整小说
- ✅ **大纲生成**：生成结构化大纲，支持导入到草稿
- ✅ **续写功能**：基于上下文智能续写
- ✅ **章节管理**：自动解析章节，支持章节导航和编辑
- ✅ **导入功能**：支持 TXT, MD, PDF, DOCX 文件导入
- ✅ **导出功能**：Markdown, PDF（按订阅计划）
- ✅ **历史记录**：本地存储的草稿历史
- ✅ **模板系统**：4 个预设模板，引导流程
- ✅ **多语言支持**：自动检测输入语言，生成对应语言内容
- ✅ **订阅系统**：基础订阅管理（Free, Starter, Pro, Unlimited）

### UI/UX
- ✅ **现代化界面**：Apple 风格设计，简洁优雅
- ✅ **响应式布局**：适配桌面和移动端
- ✅ **实时进度**：生成过程可视化
- ✅ **自动保存**：草稿自动保存机制
- ✅ **章节状态**：Drafting / Reviewing / Done 状态管理

---

## 二、竞品高级功能对比

### NovelAI（文本生成方向）

| 功能 | NovelAI | 我们 | 差距 |
|------|---------|------|------|
| **角色管理** | ✅ 完整的角色库，角色描述、关系图 | ❌ 未实现 | 🔴 高优先级 |
| **风格记忆** | ✅ Style Memory，保持写作风格一致性 | ❌ 未实现 | 🔴 高优先级 |
| **上下文长度** | ✅ 4x 更长上下文（GLM-4.6） | ⚠️ 基础上下文 | 🟡 中优先级 |
| **章节组织** | ✅ 高级章节管理，拖拽排序 | ✅ 基础章节管理 | 🟢 已实现 |
| **续写功能** | ✅ 智能续写，保持一致性 | ✅ 基础续写 | 🟢 已实现 |
| **导出格式** | ✅ 多种格式 | ⚠️ MD, PDF（DOCX/EPUB 计划中） | 🟡 中优先级 |

### Squibler（协作与工作流方向）

| 功能 | Squibler | 我们 | 差距 |
|------|----------|------|------|
| **协作功能** | ✅ 多人实时协作编辑 | ❌ 未实现 | 🟡 中优先级 |
| **版本控制** | ✅ Git-like 版本历史 | ❌ 未实现 | 🟡 中优先级 |
| **评论系统** | ✅ 章节内评论和反馈 | ❌ 未实现 | 🟡 中优先级 |
| **团队管理** | ✅ 团队空间、权限管理 | ❌ 未实现 | 🟢 低优先级 |
| **写作目标** | ✅ 字数目标、进度追踪 | ❌ 未实现 | 🟢 低优先级 |
| **AI 助手** | ✅ 智能建议、改写建议 | ⚠️ 基础续写 | 🟡 中优先级 |
| **模板库** | ✅ 丰富的行业模板 | ⚠️ 4 个基础模板 | 🟡 中优先级 |

---

## 三、核心差距分析

### 🔴 高优先级差距（影响核心体验）

#### 1. **角色管理（Character Management）**
**竞品实现：**
- NovelAI: 角色库、角色描述、关系图、角色一致性检查
- Squibler: 角色档案、角色追踪、角色一致性

**我们的差距：**
- ❌ 无法创建和管理角色
- ❌ 续写时无法保持角色一致性
- ❌ 无法追踪角色在故事中的出现

**影响：**
- 长篇小说中角色容易"失忆"或性格不一致
- 用户需要手动维护角色信息

**实现方案：**
```typescript
// 角色管理数据结构
interface Character {
  id: string;
  name: string;
  description: string;
  traits: string[];
  relationships: { characterId: string; relation: string }[];
  appearances: { chapterId: string; summary: string }[];
}
```

#### 2. **风格记忆（Style Memory）**
**竞品实现：**
- NovelAI: Style Memory 系统，学习用户的写作风格
- Squibler: 风格预设、语调控制

**我们的差距：**
- ❌ 无法学习和保持用户的写作风格
- ❌ 续写时风格可能不一致
- ❌ 无法应用特定的写作风格（如 Hemingway, Tolkien）

**影响：**
- 生成内容风格不统一
- 用户需要反复调整提示词

**实现方案：**
- 分析用户已写内容，提取风格特征
- 在续写时注入风格指令
- 提供风格预设（Literary, Commercial, Experimental）

### 🟡 中优先级差距（提升体验）

#### 3. **高级导出格式**
**当前：** MD, PDF（Starter+）
**缺失：** DOCX, EPUB（Pro+）

**实现方案：**
- DOCX: 使用 `docx` 库
- EPUB: 使用 `epub-gen` 库

#### 4. **AI 写作助手**
**竞品：** 智能建议、改写建议、语法检查
**我们：** 只有基础续写

**实现方案：**
- 段落改写
- 语调调整
- 情节建议
- 冲突检测

#### 5. **模板库扩展**
**当前：** 4 个模板
**目标：** 20+ 模板，覆盖更多类型

#### 6. **上下文长度优化**
**当前：** 基础上下文（~2000 words）
**目标：** 支持更长上下文（4000-8000 words）

### 🟢 低优先级差距（差异化功能）

#### 7. **协作功能**
- 多人实时编辑
- 评论系统
- 版本控制

#### 8. **写作目标与进度**
- 字数目标设置
- 进度可视化
- 写作统计

---

## 四、下一步迭代计划

### Phase 1: 核心功能完善（2-3 周）

#### 1.1 角色管理系统 ⭐ 高优先级
**目标：** 实现完整的角色管理功能

**功能点：**
- [ ] 角色创建界面（名称、描述、特征）
- [ ] 角色库管理（增删改查）
- [ ] 角色关系图（可视化）
- [ ] 角色一致性检查（续写时）
- [ ] 角色在章节中的追踪

**技术实现：**
- 前端：角色管理组件、关系图可视化
- 后端：角色 CRUD API、角色一致性检查逻辑
- 数据库：角色表、关系表

**预期效果：**
- 用户可以为故事创建角色
- 续写时 AI 自动参考角色信息
- 保持角色性格和关系一致性

#### 1.2 风格记忆系统 ⭐ 高优先级
**目标：** 学习和保持用户的写作风格

**功能点：**
- [ ] 风格分析（从用户已写内容提取）
- [ ] 风格预设（Literary, Commercial, Experimental）
- [ ] 风格应用（续写时自动注入）
- [ ] 风格调整（用户可手动调整）

**技术实现：**
- 前端：风格选择器、风格预览
- 后端：风格分析算法、风格指令生成
- AI Prompt: 在续写 prompt 中注入风格指令

**预期效果：**
- 生成内容风格统一
- 用户可以快速应用预设风格
- 长篇小说保持一致的语调

#### 1.3 高级导出格式
**目标：** 支持 DOCX 和 EPUB 导出

**功能点：**
- [ ] DOCX 导出（Pro+）
- [ ] EPUB 导出（Pro+）
- [ ] 导出格式选择器
- [ ] 导出选项（字体、页边距等）

**技术实现：**
- 前端：导出格式选择、选项配置
- 后端：DOCX/EPUB 生成逻辑
- 依赖：`docx`, `epub-gen` 库

### Phase 2: 体验优化（2-3 周）

#### 2.1 AI 写作助手
**功能点：**
- [ ] 段落改写（选中文本改写）
- [ ] 语调调整（正式/非正式、严肃/轻松）
- [ ] 情节建议（基于当前情节）
- [ ] 冲突检测（情节冲突、逻辑错误）

#### 2.2 模板库扩展
**功能点：**
- [ ] 新增 16+ 模板（覆盖所有主要类型）
- [ ] 模板分类（按类型、难度）
- [ ] 模板搜索和筛选

#### 2.3 上下文长度优化
**功能点：**
- [ ] 支持 4000-8000 words 上下文
- [ ] 智能上下文选择（选择最相关的部分）
- [ ] 上下文管理界面

### Phase 3: 差异化功能（3-4 周）

#### 3.1 协作功能（可选）
**功能点：**
- [ ] 多人实时编辑（WebSocket）
- [ ] 评论系统（章节内评论）
- [ ] 版本控制（Git-like 历史）

#### 3.2 写作目标与进度
**功能点：**
- [ ] 字数目标设置
- [ ] 进度可视化
- [ ] 写作统计（每日字数、完成度）

---

## 五、技术债务与优化

### 当前技术债务
1. **后端 API 限制检查**：需要实现使用量检查中间件
2. **订阅验证**：需要后端验证订阅状态
3. **数据持久化**：当前使用 localStorage，需要迁移到云端
4. **错误处理**：需要更完善的错误处理和用户提示
5. **性能优化**：长文本生成时的性能优化

### 优化方向
1. **缓存机制**：相同提示词的结果缓存
2. **队列系统**：高并发时的请求队列
3. **CDN 优化**：静态资源 CDN 加速
4. **数据库优化**：索引优化、查询优化

---

## 六、优先级排序

### 🔴 必须实现（影响核心体验）
1. **角色管理系统** - 2-3 周
2. **风格记忆系统** - 2-3 周
3. **高级导出格式** - 1 周

### 🟡 应该实现（提升体验）
4. **AI 写作助手** - 2-3 周
5. **模板库扩展** - 1-2 周
6. **上下文长度优化** - 1-2 周

### 🟢 可以考虑（差异化）
7. **协作功能** - 3-4 周
8. **写作目标与进度** - 1-2 周

---

## 七、成功指标

### 功能完成度
- Phase 1 完成：核心功能完善，达到竞品基础水平
- Phase 2 完成：体验优化，部分功能超越竞品
- Phase 3 完成：差异化功能，形成独特优势

### 用户指标
- 用户留存率提升 20%
- 平均使用时长增加 30%
- 付费转化率提升 15%

---

## 八、风险评估

### 技术风险
- **角色管理复杂度**：关系图可视化可能复杂
- **风格分析准确性**：风格提取算法需要大量测试
- **协作功能**：WebSocket 实时同步可能有问题

### 应对策略
- 分阶段实现，先实现核心功能
- 充分测试，收集用户反馈
- 准备降级方案（如协作功能可先实现基础版本）


